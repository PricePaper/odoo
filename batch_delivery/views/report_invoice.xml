<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <template id="ppt_address_layoyt" inherit_id="web.address_layout">
            <xpath expr="//t[2]/div/t" position="after">
                <t t-if="delivery_address">
                    <t t-set="colclass" t-value="'col-4 offset-0'"/>
                    <div name="delivery_address" t-att-class="colclass">
                        <strong>Delivery Address :</strong>
                        <t t-raw="delivery_address"/>
                    </div>
                </t>
            </xpath>
            <xpath expr="//div[@name='address']" position="replace">
                <div name="address" class="col-3">
                    <strong t-if="o._name == 'account.invoice'">Billing Address :</strong>
                    <t t-raw="address"/>
                </div>
                <t t-if="customer_extra_info">
                    <t t-set="colclass" t-value="'col-4 offset-0'"/>
                    <div name="customer_extra_info" t-att-class="colclass">
                        <t t-raw="customer_extra_info"/>
                    </div>
                </t>
            </xpath>
        </template>
        <template id="ppt_external_layout_standard" inherit_id="web.external_layout_standard">
            <xpath expr="//div[@name='company_address']" position="after">
                <div class="col-6 text-right" name="customer_info"
                     t-if="o._name == 'account.invoice' and customer_info">
                    <span t-esc="customer_info"/>
                </div>
            </xpath>
        </template>

<!--        <template id="report_invoice_document_ppt_with_payments" inherit_id="account.report_invoice_document">-->
<!--            <xpath expr="//table[@name='invoice_line_table']" position="after">-->
<!--                <t t-set="SL"-->
<!--                   t-value="o.mapped('invoice_line_ids').mapped('sale_line_ids.order_id').mapped('order_line').filtered(lambda r: not r.is_delivery and r.product_uom_qty != r.qty_delivered)"/>-->
<!--                <t t-if="SL">-->
<!--                    <div style="font-weight: bolder; margin-top:100px;">Product ordered but not-->
<!--                        delivered</div>-->
<!--                    <table class="table table-sm o_main_table">-->
<!--                        <thead>-->
<!--                            <tr>-->
<!--                                <t t-set="colspan" t-value="6"/>-->
<!--                                <th class="text-left"><span>No#</span></th>-->
<!--                                <th class="text-left"><span>Description</span></th>-->
<!--                                <th class="text-right"><span>Unavailable Quantity</span></th>-->
<!--                            </tr>-->
<!--                        </thead>-->
<!--                        <tbody class="invoice_tbody">-->
<!--                            <t t-set="line_count" t-value="0"/>-->
<!--                            <t t-foreach="SL"-->
<!--                               t-as="line">-->
<!--                                <t t-set="line_count" t-value="line_count + 1"/>-->
<!--                                <tr>-->
<!--                                    <td name="account_invoice_line_name"><span t-esc="line_count"/></td>-->
<!--                                    <td name="account_invoice_line_name"><span t-field="line.name"/></td>-->
<!--                                    <td class="text-right">-->
<!--                                        <span t-esc="line.product_uom_qty - line.qty_delivered"/>-->
<!--                                        <span t-field="line.product_uom" groups="uom.group_uom"/>-->
<!--                                    </td>-->
<!--                                </tr>-->
<!--                            </t>-->
<!--                        </tbody>-->
<!--                    </table>-->
<!--                </t>-->
<!--            </xpath>-->
<!--        </template>-->

<!--        <template id="report_ppt_invoice_document" inherit_id="account.report_invoice_document" primary="True">-->

<!--            <xpath expr="//table[@name='invoice_line_table']/thead/tr/th[4]" position="attributes">-->
<!--                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>-->
<!--            </xpath>-->
<!--            <xpath expr="//table/tbody//tr/t[@name='account_invoice_line_accountable']/td[3]/span[2]"-->
<!--                   position="replace">-->
<!--            </xpath>-->
<!--            <xpath expr="//table[@name='invoice_line_table']/thead/tr/th[5]" position="attributes">-->
<!--                <attribute name="invisible">True</attribute>-->
<!--            </xpath>-->
<!--            <xpath expr="//table[@name='invoice_line_table']/thead/tr/th[6]" position="attributes">-->
<!--                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>-->
<!--            </xpath>-->
<!--            <xpath expr="//table[@name='invoice_line_table']/thead/tr/th[7]" position="attributes">-->
<!--                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>-->
<!--            </xpath>-->
<!--            <xpath expr="//tbody//tr/t[@name='account_invoice_line_accountable']/td[4]" position="attributes">-->
<!--                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>-->
<!--            </xpath>-->
<!--            <xpath expr="//tbody//tr/t[@name='account_invoice_line_accountable']/td[5]" position="attributes">-->
<!--                <attribute name="invisible">True</attribute>-->
<!--            </xpath>-->
<!--            <xpath expr="//tbody//tr/t[@name='account_invoice_line_accountable']/td[7]" position="attributes">-->
<!--                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>-->
<!--            </xpath>-->
<!--            <xpath expr="//tr[hasclass('is-subtotal')]" position="attributes">-->
<!--                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>-->
<!--            </xpath>-->
<!--            <xpath expr="//tbody//tr/t[@name='account_invoice_line_accountable']/td[6]" position="attributes">-->
<!--                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>-->
<!--            </xpath>-->
<!--            <xpath expr="//div[hasclass('clearfix')]" position="attributes">-->
<!--                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>-->
<!--            </xpath>-->
<!--            &lt;!&ndash;            <xpath expr="//div[@id='informations']/div[@name='invoice_date']" position="replace"/>&ndash;&gt;-->
<!--            <xpath expr="//div[@id='informations']/div[@name='reference']" position="after">-->
<!--                <div name="payment_term" class="col-auto mw-100 mb-2" t-if="o.payment_term_id">-->
<!--                    <strong>Payment Terms:</strong>-->
<!--                    <p class="m-0" t-field="o.payment_term_id.note"/>-->
<!--                </div>-->
<!--                <xpath expr="//div[@id='informations']/div[@name='due_date']" position="move"/>-->
<!--            </xpath>-->
<!--            <xpath expr="//table[@name='invoice_line_table']/thead/tr/th[1]" position="before">-->
<!--                <th class="text-left"><span>No#</span></th>-->
<!--                <th class="text-left"><span>Product Code</span></th>-->
<!--            </xpath>-->
<!--            <xpath expr="//tbody//tr/t[@name='account_invoice_line_accountable']/td[1]" position="before">-->
<!--                <td name="product_code"><span t-field="line.line_number"/></td>-->
<!--                <td name="product_code"><span t-field="line.product_id.default_code"/></td>-->
<!--            </xpath>-->
<!--            <xpath expr="//t/div/p[1]" position="before">-->
<!--                <strong class="mr16">Total Units:</strong>-->
<!--                <span t-esc="'{0:.02f}'.format(sum([l.quantity for l in o.invoice_line_ids]))"/>-->
<!--            </xpath>-->
<!--            <xpath expr="//table[@name='invoice_line_table']/thead/tr/th[2]" position="after">-->
<!--                <th class="text-right"><span>Uom</span></th>-->
<!--            </xpath>-->
<!--            <xpath expr="//table/tbody//tr/t[@name='account_invoice_line_accountable']/td[3]" position="before">-->
<!--                <td class="text-right">-->
<!--                    <span t-field="line.uom_id" groups="uom.group_uom"/>-->
<!--                </td>-->
<!--            </xpath>-->
<!--            <xpath expr="//div/h2/span[2]" position="replace">-->
<!--                <span t-if="o.type == 'out_invoice' and o.state == 'draft'">Invoice</span>-->
<!--            </xpath>-->
<!--            <xpath expr="//div/h2/span[7]" position="replace">-->
<!--                <span t-field="o.move_name"/>-->
<!--            </xpath>-->
<!--            <xpath expr="//t/div/p[3]" position="replace"/>-->
<!--            <xpath expr="//t/t[2]" position="before">-->
<!--                <t t-set="delivery_address">-->
<!--                    <address t-field="o.partner_shipping_id"-->
<!--                             t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>-->
<!--                </t>-->

<!--            </xpath>-->
<!--        </template>-->



        <template id="ppt_custom_invoice_template">
            <div class="header" t-att-style="report_header_style">

                <img t-if="company.logo" t-att-src="image_data_uri(company.logo)" class="float-left" alt="Logo"
                     style="max-height: 3cm; max-width: 3cm;"/>
                <div class="float-left company_address" style="padding-left:18px;">
                    <div>
                        <strong t-field="company.partner_id.name"/>
                    </div>
                    <span t-field="company.partner_id"
                          t-options='{"widget": "contact", "fields": ["address"], "no_marker": true}'/>
                    <div style="color:grey;font-style: italic;" t-field="company.report_header" name="moto"/>
                </div>
                <div class="text-right" style="font-weight: bold;">
                    <span>Invoice(DO) Number</span> <span t-field="o.move_name" style="padding-left:10px;"/><br/>
                    <span>Date:</span><span t-field="o.date_invoice" style="padding-left:10px;"/>
                </div>


                <div t-if="company.logo or company.report_header" class="row zero_min_height">
                    <div class="col-12">
                        <div style="border-bottom: 1px solid black;"/>
                    </div>
                </div>
            </div>

            <div class="article o_report_layout_standard" t-att-data-oe-model="o and o._name"
                 t-att-data-oe-id="o and o.id" t-att-data-oe-lang="o and o.env.context.get('lang')"
                 style="font-family: 'Lato', 'Noto'; font-size:16px;">
                <t t-call="web.address_layout"/>
                <t t-set="o" t-value="o.with_context(lang=lang)"/>
                <t t-set="address">
                    <address t-field="o.partner_id"
                             t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                </t>
                <t t-set="delivery_address">
                    <address t-field="o.partner_shipping_id"
                             t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                </t>
                <t t-set="SO" t-value="o.invoice_line_ids.mapped('sale_line_ids').mapped('order_id')"/>
                <t t-set="customer_extra_info">
                    <div t-if="o.partner_id.customer_code" class="mt4">
                        Partner Code: <span t-field="o.partner_id.customer_code"/>
                    </div>
                     <div t-if="o.partner_shipping_id.phone" class="mt4">
                        Contact Phone: <span t-field="o.partner_shipping_id.phone"/>
                    </div>
                    <div t-if="o.partner_id.vat" class="mt4">
                        Resale Number: <span t-field="o.partner_id.vat"/>
                    </div>
                    <div t-if="SO and SO.carrier_id" class="mt4">
                        Shipping Method: <span t-field="SO.carrier_id"/>
                    </div>
                </t>
                <t t-call="web.address_layout"/>
                <div class="page">
                    <h2>
                        <span t-if="o.type == 'out_invoice' and o.state in ('open', 'in_payment', 'paid')">
                            Invoice</span>
                        <span t-if="o.type == 'out_invoice' and o.state == 'draft'">Invoice</span>
                        <span t-if="o.type == 'out_invoice' and o.state == 'cancel'">Cancelled Invoice</span>
                        <span t-if="o.type == 'out_refund'">Credit Note</span>
                        <span t-if="o.type == 'in_refund'">Vendor Credit Note</span>
                        <span t-if="o.type == 'in_invoice'">Vendor Bill</span>
                        <span t-field="o.move_name"/>
                    </h2>

                    <div id="informations" class="row mt32 mb32" style="font-size:15px;">
                        <div class="col-auto mw-100 mb-2" t-if="o.sales_person_ids">
                            <strong>Salespersons:</strong>
                            <p t-esc="','.join([str(s.id) for s in o.sales_person_ids])"/>
                        </div>
                        <div class="col-auto mw-100 mb-2" t-if="o.origin" name="origin">
                            <strong>Source:</strong>
                            <p class="m-0" t-field="o.origin"/>
                        </div>
                         <div class="col-auto mw-100 mb-2" t-if="SO and SO.client_order_ref" name="origin">
                            <strong>Customer Reference:</strong>
                            <p class="m-0" t-field="SO.client_order_ref"/>
                        </div>
                        <div name="payment_term" class="col-auto mw-100 mb-2" t-if="o.payment_term_id">
                            <strong>Payment Terms:</strong>
                            <p class="m-0" t-field="o.payment_term_id.note"/>
                        </div>
                        <div class="col-auto mw-100 mb-2" t-if="o.name" name="description">
                            <strong>Description:</strong>
                            <p class="m-0" t-field="o.name"/>
                        </div>
                        <div class="col-auto mw-100 mb-2" t-if="o.type == 'out_invoice'" name="due_date">
                            <t t-set="pterm_list"
                               t-value="o.payment_term_id.with_context(currency_id=o.company_id.currency_id.id).compute(value=1, date_ref=date_invoice)[0]"/>
                            <strong>Due Date:</strong>
                            <p class="m-0" t-esc="max(line[0] for line in pterm_list)"/>
                        </div>

                    </div>

                    <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])"/>

                    <table class="table table-sm o_main_table" name="invoice_line_table">
                        <thead>
                            <tr>
                                <!-- TODO: remove in master -->
                                <t t-set="colspan" t-value="6"/>
                                <th class="text-left"><span>Ln#</span></th>
                                <th class="text-left"><span>Product</span></th>
                                <th class="text-right"><span>Quantity</span></th>
                                <th class="text-left"><span>Unit</span></th>
                                <th class="text-left"><span>Description</span></th>
                                <th t-attf-class="text-left {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}"
                                    t-if="o.partner_id.bill_with_goods"><span>Taxes</span></th>
                                <th class="text-right" t-if="o.partner_id.bill_with_goods">
                                    <span groups="account.group_show_line_subtotals_tax_excluded">Amount</span>
                                    <span groups="account.group_show_line_subtotals_tax_included">Total Price</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="invoice_tbody" style="font-size:13px;">
                            <t t-set="current_subtotal" t-value="0"/>
                            <t t-set="line_count" t-value="0"/>
                            <t t-foreach="o.invoice_line_ids" t-as="line">

                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal"
                                   groups="account.group_show_line_subtotals_tax_excluded"/>
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_total"
                                   groups="account.group_show_line_subtotals_tax_included"/>

                                <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                    <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                        <t t-set="line_count" t-value="line_count + 1"/>
                                        <td name="account_invoice_line_name"><span t-esc="line_count"/></td>
                                        <td name="account_invoice_line_name"><span
                                                t-field="line.product_id.default_code"/></td>
                                        <td class="text-right"><span t-field="line.quantity"/></td>
                                        <td class="text-left"><span t-field="line.uom_id" groups="uom.group_uom"/></td>
                                        <td name="account_invoice_line_name"><span t-field="line.name"/></td>
                                        <td t-attf-class="text-left {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}"
                                            t-if="o.partner_id.bill_with_goods">
                                            <span t-esc="', '.join(map(lambda x: (x.description or x.name), line.invoice_line_tax_ids))"/>
                                        </td>
                                        <td class="text-right o_price_total" t-if="o.partner_id.bill_with_goods">
                                            <span t-field="line.price_subtotal"
                                                  groups="account.group_show_line_subtotals_tax_excluded"/>
                                            <span t-field="line.price_total"
                                                  groups="account.group_show_line_subtotals_tax_included"/>
                                        </td>
                                    </t>
                                    <t t-if="line.display_type == 'line_section'">
                                        <td colspan="99"><span t-field="line.name"/></td>
                                        <t t-set="current_section" t-value="line"/>
                                        <t t-set="current_subtotal" t-value="0"/>
                                    </t>
                                    <t t-if="line.display_type == 'line_note'">
                                        <td colspan="99"><span t-field="line.name"/></td>
                                    </t>
                                </tr>

                                <t t-if="o.partner_id.bill_with_goods and current_section and (line_last or o.invoice_line_ids[line_index+1].display_type == 'line_section')">
                                    <tr class="is-subtotal text-right">
                                        <td colspan="99">
                                            <strong class="mr16">Subtotal</strong>
                                            <span t-esc="current_subtotal"
                                                  t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                                        </td>
                                    </tr>
                                </t>
                            </t>
                        </tbody>
                    </table>
                    <t t-set="SL"
                       t-value="o.mapped('invoice_line_ids').mapped('sale_line_ids.order_id').mapped('order_line').filtered(lambda r: not r.is_delivery and r.product_uom_qty != r.qty_delivered)"/>
                    <t t-if="SL">
                        <div style="font-weight: bolder; margin-top:100px;">Product ordered but not
                            delivered</div>
                        <table class="table table-sm o_main_table">
                            <thead>
                                <tr>
                                    <t t-set="colspan" t-value="6"/>
                                    <th class="text-left"><span>No#</span></th>
                                    <th class="text-left"><span>Description</span></th>
                                    <th class="text-right"><span>Unavailable Quantity</span></th>
                                </tr>
                            </thead>
                            <tbody class="invoice_tbody">
                                <t t-set="line_count" t-value="0"/>
                                <t t-foreach="SL"
                                   t-as="line">
                                    <t t-set="line_count" t-value="line_count + 1"/>
                                    <tr>
                                        <td name="account_invoice_line_name"><span t-esc="line_count"/></td>
                                        <td name="account_invoice_line_name"><span t-field="line.name"/></td>
                                        <td class="text-right">
                                            <span t-esc="line.product_uom_qty - line.qty_delivered"/>
                                            <span t-field="line.product_uom" groups="uom.group_uom"/>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </t>
                    <div class="clearfix">
                        <div id="total" class="row" t-if="o.partner_id.bill_with_goods">
                            <div t-attf-class="#{'col-4' if report_type != 'html' else 'col-sm-7 col-md-5'} ml-auto">
                                <table class="table table-sm" style="page-break-inside: avoid;">
                                    <tr class="border-black o_subtotal" style="">
                                        <td><strong>Subtotal</strong></td>
                                        <td class="text-right">
                                            <span t-field="o.amount_untaxed"/>
                                        </td>
                                    </tr>
                                    <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                                        <tr style="">
                                            <t t-if="len(o.tax_line_ids) == 1 and o.amount_untaxed == amount_by_group[2]">
                                                <td><span t-esc="amount_by_group[0]"/></td>
                                                <td class="text-right o_price_total">
                                                    <span t-esc="amount_by_group[3]"/>
                                                </td>
                                            </t>
                                            <t t-else="">
                                                <td>
                                                    <span t-esc="amount_by_group[0]"/>
                                                    <span>&amp;nbsp;<span>on</span>
                                                        <t t-esc="amount_by_group[4]"/>
                                                    </span>
                                                </td>
                                                <td class="text-right o_price_total">
                                                    <span t-esc="amount_by_group[3]"/>
                                                </td>
                                            </t>
                                        </tr>
                                    </t>
                                    <tr class="border-black o_total">
                                        <td><strong>Total</strong></td>
                                        <td class="text-right">
                                            <span t-field="o.amount_total"/>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                    <strong class="mr16">Total Units:</strong>
                    <span t-esc="'{0:.02f}'.format(sum([l.quantity for l in o.invoice_line_ids]))"/>
                    <br/>
                    <strong class="mr16">Current Balance :</strong>
                    <span t-esc="'${0:.02f}'.format(o.residual)"/> as of <t t-esc="time.strftime('%m/%d/%Y', time.localtime())"/>
                    <p t-if="o.reference">
                        Please use the following communication for your payment : <b><span t-field="o.reference"/></b>
                    </p>
                    <p t-if="o.comment" name="comment">
                        <span t-field="o.comment"/>
                    </p>
                    <p t-if="o.fiscal_position_id.note" name="note">
                        <span t-field="o.fiscal_position_id.note"/>
                    </p>
                    <div id="qrcode"
                         t-if="(o.company_id.qr_code) and (o.currency_id.name == 'EUR') and (o.partner_bank_id.acc_number != False)">
                        <p t-if="(o.partner_bank_id.qr_code_valid)">
                            <strong class="text-center">Scan me with your banking app.</strong><br/><br/>
                            <img class="border border-dark rounded"
                                 t-att-src="o.partner_bank_id.build_qr_code_url(o.residual,(o.reference) if (o.reference) else o.number)"/>
                        </p>
                        <p t-if="(o.partner_bank_id.qr_code_valid == False)">
                            <strong class="text-center">The SEPA QR Code informations are not set
                                correctly.</strong><br/>
                        </p>
                    </div>

                </div>
            </div>

            <div class="footer o_standard_footer">
                <div class="text-center">
                    <ul class="list-inline">
                        <li t-if="company.phone" class="list-inline-item"><i class="fa fa-phone" role="img" aria-label="Phone" title="Phone"/>
                            <span t-field="company.phone"/>
                        </li>
                        <li t-if="company.email" class="list-inline-item"><i class="fa fa-at" role="img" aria-label="Email" title="Email"/>
                            <span t-field="company.email"/>
                        </li>
                        <li t-if="company.website" class="list-inline-item"><i class="fa fa-globe" role="img" aria-label="Website" title="Website"/>
                            <span t-field="company.website"/>
                        </li>
                        <li t-if="company.vat" class="list-inline-item"><i class="fa fa-building-o" role="img" aria-label="Fiscal number"/>
                            <t t-esc="(company.country_id.vat_label or 'Tax ID').replace(' ','\N{NO-BREAK SPACE}')"/> : <span t-esc="company.vat.replace(' ','\N{NO-BREAK SPACE}')"/></li>
                    </ul>
                    <div t-field="company.report_footer"/>
                    <div t-if="iv == 1">Customer Copy</div>
                    <div t-if="report_type == 'pdf'" class="text-muted">
                        Page:
                        <span class="page"/>
                        of
                        <span class="topage"/>
                    </div>
                </div>
            </div>
        </template>

        <template id="preview_externalreport_test">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-set="company" t-value="o.company_id.sudo()"/>
                    <t t-call="batch_delivery.ppt_custom_invoice_template">

                    </t>
                </t>
            </t>
        </template>

        <template id="report_ppt_batch_invoice">
            <t t-call="web.html_container">
                <t t-foreach="docs.mapped('picking_ids').sorted(key=lambda p: p.sequence, reverse=True).mapped('invoice_ids').filtered(lambda r: r.state != 'cancel')"
                   t-as="o">
                    <t t-set="company" t-value="o.company_id.sudo()"/>
                    <t t-foreach="range(2)" t-as="iv">
                        <t t-call="batch_delivery.ppt_custom_invoice_template" t-lang="lang"/>
                    </t>
                </t>
            </t>
        </template>

        <template id="report_ppt_selected_invoice">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-set="company" t-value="o.company_id.sudo()"/>
                    <t t-foreach="range(2)" t-as="iv">
                        <t t-call="batch_delivery.ppt_custom_invoice_template" t-lang="lang"/>
                    </t>
                </t>
            </t>
        </template>

    </data>
</odoo>