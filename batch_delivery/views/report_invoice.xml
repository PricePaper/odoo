<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <template id="ppt_address_layoyt" inherit_id="web.address_layout">
            <xpath expr="//t[2]/div/t" position="after">
                 <t t-if="delivery_address">
                     <t t-set="colclass" t-value="'col-3 offset-5'"/>
                    <div name="delivery_address" t-att-class="colclass">
                        <strong>Delivery Address :</strong>
                        <t t-raw="delivery_address"/>
                    </div>
                </t>
            </xpath>
            <xpath expr="//div[@name='address']" position="replace">
                <div name="address" class="col-3">
                    <strong t-if="o._name == 'account.invoice'">Billing Address :</strong>
                    <t t-raw="address"/>
                </div>
            </xpath>
        </template>

        <template id="report_invoice_document_ppt_with_payments" inherit_id="account.report_invoice_document">
            <xpath expr="//table[@name='invoice_line_table']" position="after">
                <t t-set="SL" t-value="o.mapped('invoice_line_ids').mapped('sale_line_ids.order_id').mapped('order_line').filtered(lambda r: not r.is_delivery and r.product_uom_qty != r.qty_delivered)"/>
                <t t-if="SL">
                    <div style="font-weight: bolder; margin-top:100px;">Product ordered but not
                        delivered</div>
                    <table class="table table-sm o_main_table">
                        <thead>
                            <tr>
                                <t t-set="colspan" t-value="6"/>
                                <th class="text-left"><span>Description</span></th>
                                <th class="text-right"><span>Unavailable Quantity</span></th>
                            </tr>
                        </thead>
                        <tbody class="invoice_tbody">
                            <t t-foreach="SL"
                               t-as="line">
                                <tr>
                                    <td name="account_invoice_line_name"><span t-field="line.name"/></td>
                                    <td class="text-right">
                                        <span t-esc="line.product_uom_qty - line.qty_delivered"/>
                                        <span t-field="line.product_uom" groups="uom.group_uom"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </t>
            </xpath>
        </template>

        <report
                id="ppt_account_invoices_report"
                model="account.invoice"
                string="Invoices without Payment"
                report_type="qweb-pdf"
                menu="False"
                name="batch_delivery.report_ppt_invoice"
                file="batch_delivery.report_ppt_invoice"
                attachment="(object.state in ('open','in_payment','paid')) and ('INV'+(object.number or '').replace('/','')+'.pdf')"
                print_report_name="(object._get_report_base_filename())"
        />

        <template id="report_ppt_invoice_document" inherit_id="account.report_invoice_document" primary="True">

            <xpath expr="//table[@name='invoice_line_table']/thead/tr/th[4]" position="attributes">
                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>
            </xpath>
            <xpath expr="//table/tbody/t[2]/tr/t[@name='account_invoice_line_accountable']/td[3]/span[2]" position="replace">
            </xpath>
            <xpath expr="//table[@name='invoice_line_table']/thead/tr/th[5]" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <xpath expr="//table[@name='invoice_line_table']/thead/tr/th[6]" position="attributes">
                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>
            </xpath>
            <xpath expr="//table[@name='invoice_line_table']/thead/tr/th[7]" position="attributes">
                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>
            </xpath>
            <xpath expr="//tbody/t[2]/tr/t[@name='account_invoice_line_accountable']/td[4]" position="attributes">
                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>
            </xpath>
            <xpath expr="//tbody/t[2]/tr/t[@name='account_invoice_line_accountable']/td[5]" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <xpath expr="//tbody/t[2]/tr/t[@name='account_invoice_line_accountable']/td[7]" position="attributes">
                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>
            </xpath>
            <xpath expr="//tr[hasclass('is-subtotal')]" position="attributes">
                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>
            </xpath>
            <xpath expr="//tbody/t[2]/tr/t[@name='account_invoice_line_accountable']/td[6]" position="attributes">
                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>
            </xpath>
            <xpath expr="//div[hasclass('clearfix')]" position="attributes">
                <attribute name="t-if">o.partner_id.bill_with_goods</attribute>
            </xpath>
<!--            <xpath expr="//div[@id='informations']/div[@name='invoice_date']" position="replace"/>-->
            <xpath expr="//div[@id='informations']/div[@name='reference']" position="after">
                <div name="payment_term" class="col-auto mw-100 mb-2" t-if="o.payment_term_id">
                    <strong>Payment Terms:</strong>
                        <p class="m-0" t-field="o.payment_term_id.note"/>
                </div>
                <xpath expr="//div[@id='informations']/div[@name='due_date']" position="move"/>
            </xpath>
            <xpath expr="//table[@name='invoice_line_table']/thead/tr/th[1]" position="before">
                 <th class="text-left"><span>Product Code</span></th>
            </xpath>
            <xpath expr="//tbody/t[2]/tr/t[@name='account_invoice_line_accountable']/td[1]" position="before">
                <td name="product_code"><span t-field="line.product_id.default_code"/></td>
            </xpath>
            <xpath expr="//t/div/p[1]" position="before">
                <strong class="mr16">Total Units:</strong>
                <span t-esc="'{0:.02f}'.format(sum([l.quantity for l in o.invoice_line_ids]))"/>
            </xpath>
             <xpath expr="//table[@name='invoice_line_table']/thead/tr/th[2]" position="after">
                <th class="text-right"><span>Uom</span></th>
            </xpath>
            <xpath expr="//table/tbody/t[2]/tr/t[@name='account_invoice_line_accountable']/td[3]" position="before">
                <td  class="text-right">
                     <span t-field="line.uom_id"  groups="uom.group_uom"/>
                </td>
            </xpath>
            <xpath expr="//div/h2/span[2]" position="replace">
                <span t-if="o.type == 'out_invoice' and o.state == 'draft'">Invoice</span>
            </xpath>
            <xpath expr="//div/h2/span[7]" position="replace">
                <span t-field="o.move_name"/>
            </xpath>
            <xpath expr="//t/div/p[3]" position="replace"/>
            <xpath expr="//t/t[2]" position="before">
                 <t t-set="delivery_address">
                    <address t-field="o.partner_shipping_id" t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                </t>
            </xpath>
        </template>

        <template id="report_ppt_invoice">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-set="lang"
                       t-value="o.user_id.sudo().lang if o.type in ('in_invoice', 'in_refund') else o.partner_id.lang"/>
                    <t t-call="batch_delivery.report_ppt_invoice_document" t-lang="lang"/>
                </t>
            </t>
        </template>


    </data>
</odoo>