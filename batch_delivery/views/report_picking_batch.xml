<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <template id="report_picking_batch123">
            <t t-call="web.html_container">
                        <t t-foreach="pickings" t-as="ob">
                                <div class="header">
                                    <div class="row" style="font-weight: bolder; padding-bottom:10px;">
                                        <div class="col-5" style="text-align:left;">
                                            <span t-field="ob.partner_id.name"/>
                                        </div>
                                        <div class="col-3" style="text-align:right;">
                                            Delivery Order
                                        </div>
                                        <div class="col-2" style="text-align:left;">
                                            <span t-esc="ob.name"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="article" t-att-data-oe-model="ob and ob._name" t-att-data-oe-id="ob and ob.id" t-att-data-oe-lang="ob and ob.env.context.get('lang')">
                                     <div class="page">
                                        <p style="page-break-after: always;"/>
                                         <style>
                                            .o_main_table td {
                                                padding: 0.75rem;
                                                vertical-align: top;
                                                border-top: 1px solid black;
                                            }
                                             .ppt_info td {
                                             border: none;
                                             }
                                         </style>
                                        <table class="table ppt_info">
                                            <tr>
                                                <td style="text-align:right;  padding-bottom:10px; font-weight: bolder;">Batch
                                                    Assignment/ Sequence</td>
                                                <td style="text-align:left;padding-left: 10px;  padding-bottom:10px;">
                                                    <span t-field="ob.batch_id"/> / <span t-esc=" ob.sequence + 1"/>
                                                </td>
                                                <td style="text-align:right;  padding-bottom:10px; font-weight: bolder;">Delivery
                                                    Date</td>
                                                <td style="text-align:left;padding-left: 10px;  padding-bottom:10px;">
                                                    <span t-field="ob.date"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="text-align:right;  padding-bottom:10px; font-weight: bolder;">Total
                                                    Units</td>
                                                <td style="text-align:left;padding-left: 10px;  padding-bottom:10px;">
                                                    <span t-esc="'{0: 0.2f}'.format(sum(ob.move_ids_without_package.mapped('product_uom_qty')))"/>
                                                </td>
                                                <td style="text-align:right;  padding-bottom:10px; font-weight: bolder;">Total
                                                    Weight</td>
                                                <td style="text-align:left;padding-left: 10px;  padding-bottom:10px;">
                                                    <span t-esc="'{0: 0.2f}'.format(sum(ob.move_ids_without_package.mapped(lambda m: m.product_uom_qty * m.product_id.weight)))"/>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="text-align:right;  padding-bottom:10px; font-weight: bolder;">Total
                                                    Volume</td>
                                                <td style="text-align:left;padding-left: 10px;  padding-bottom:10px;">
                                                    <span t-esc="'{0: 0.2f}'.format(sum(ob.move_lines.mapped(lambda m: m.product_uom_qty * m.product_id.volume)))"/>
                                                </td>
                                                <td style="text-align:right;  padding-bottom:10px; font-weight: bolder;">DO
                                                    Barcode</td>
                                                <td style="text-align:left;padding-left: 10px;  padding-bottom:10px;">
                                                    <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('Code128', ob.name, 600, 100)"
                                                         style="width:300px;height:50px" alt="Barcode"/>
                                                </td>
                                            </tr>
                                        </table>
                                        <br/>
                                        <table class="table table-sm o_main_table">
                                            <tbody>
                                                <t t-set="index" t-value="1"/>
                                                <tr t-foreach="ob.move_ids_without_package.sorted(key=lambda r: r.location_id.display_name.split('/')[-1])" t-as="move"
                                                    style="font-family: Roboto, Odoo Unicode Support Noto, sans-serif;font-size: 14px; font-weight: 500;">
                                                    <td>
                                                        <span t-esc="index"/>
                                                    </td>
                                                    <td>
                                                        <span t-field="move.product_id.default_code"/>
                                                    </td>
                                                    <td>
                                                        <span t-field="move.product_id.name"/>
                                                    </td>
                                                    <td>
                                                        <span t-field="move.product_id.description_pickingout"/>
                                                    </td>
                                                    <td>
                                                        <span t-field="move.product_uom"/>
                                                    </td>
                                                    <td>
                                                        <span t-field="move.reserved_availability"/>
                                                    </td>
                                                    <td>
                                                        <span>_____</span>
                                                    </td>
                                                    <td>
                                                        <span t-field="move.location_id"/>
                                                    </td>

                                                    <t t-if="move">
                                                        <t t-set="index" t-value="index + 1"/>
                                                    </t>
                                                </tr>
                                            </tbody>
                                        </table>
                                         <div class="footer">
                                            <div class="text-center" style="border-top: 1px solid black;">
                                                Batch <span t-field="ob.batch_id" style="padding-left: 10px;padding-right: 10px"/>
                                                Sequence <span t-esc="ob.sequence + 1" style="padding-left: 10px;padding-right: 10px"/>
                                                Partner: <span t-esc="ob.partner_id.customer_code" style="padding-left: 10px;padding-right: 10px"/>
                                                Page: <span class="page"/> / <span class="topage"/>
                                            </div>
                                         </div>
                                        <p style="page-break-after: always;"/>
                                    </div>
                                </div>
                        </t>
            </t>
        </template>

        <template id="report_batch_picking_all">
            <t t-foreach="docs" t-as="batch_doc">
                <t t-set="batch" t-value="batch_doc"/>
                <t t-set="pickings" t-value="batch_doc.mapped('picking_ids').sorted(key=lambda p: p.sequence, reverse=True)"/>
                <t t-call="batch_delivery.report_picking_batch123"/>
            </t>
        </template>

        <template id="report_batch_picking_active">
            <t t-set="pickings" t-value="docs"/>
            <t t-set="batch" t-value="docs.mapped('batch_id')"/>
            <t t-call="batch_delivery.report_picking_batch123"/>
        </template>


    </data>
</odoo>
