<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>


        <template id="report_picking_batch123">
            <t t-call="web.html_container">
                <t t-call="web.basic_layout">

                        <t t-foreach="pickings" t-as="ob">
                             <div class="page">
                             <p style="page-break-after: always;"/>
                            <table class="table">
                                <tr>
                                    <td style="text-align:right; font-weight: bolder; padding-bottom:10px;">
                                        Delivery-address</td>
                                    <td style="text-align:left;padding-left: 10px;  padding-bottom:10px;">
                                        <span t-esc="ob.partner_id.name"/>
                                        <span t-field="ob.partner_id"
                                              t-options="{'widget': 'contact', 'fields': ['address'], 'no_marker': True}"/>
                                    </td>
                                    <td style="text-align:right; font-weight: bolder; padding-bottom:10px;">Delivery
                                        Order</td>
                                    <td style="text-align:left;padding-left: 10px;padding-bottom:10px;font-weight:bold">
                                        <span t-esc="ob.name"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align:right;  padding-bottom:10px; font-weight: bolder;">Batch
                                        Assignment/ Sequence</td>
                                    <td style="text-align:left;padding-left: 10px;  padding-bottom:10px; font-weight:bold">
                                        <span t-field="ob.batch_id"/>
                                    </td>
                                    <td style="text-align:right;  padding-bottom:10px; font-weight: bolder;">Delivery
                                        Date</td>
                                    <td style="text-align:left;padding-left: 10px;  padding-bottom:10px; font-weight:bold">
                                        <span t-field="ob.date"/>
                                    </td>

                                </tr>
                                <tr>
                                    <td style="text-align:right;  padding-bottom:10px; font-weight: bolder;">Total
                                        Units</td>
                                    <td style="color:red;text-align:left;padding-left: 10px;  padding-bottom:10px;">
                                        <span t-esc="sum(ob.move_lines.mapped('product_uom_qty'))"/>
                                    </td>
                                    <td style="text-align:right;  padding-bottom:10px; font-weight: bolder;">Total
                                        Weight</td>
                                    <td style="color:red;text-align:left;padding-left: 10px;  padding-bottom:10px;">
                                        <span t-esc="sum(ob.move_lines.mapped(lambda m: m.product_uom_qty * m.product_id.weight))"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align:right;  padding-bottom:10px; font-weight: bolder;">Total
                                        Volume</td>
                                    <td style="color:red;text-align:left;padding-left: 10px;  padding-bottom:10px;">
                                        <span t-esc="sum(ob.move_lines.mapped(lambda m: m.product_uom_qty * m.product_id.volume))"/>
                                    </td>
                                    <td style="text-align:right;  padding-bottom:10px; font-weight: bolder;">DO
                                        Barcode</td>
                                    <td style="text-align:left;padding-left: 10px;  padding-bottom:10px;">
                                        <img t-att-src="'/report/barcode/?type=%s&amp;value=%s&amp;width=%s&amp;height=%s' % ('Code128', obname, 600, 100)"
                                             style="width:300px;height:50px" alt="Barcode"/>
                                    </td>
                                </tr>
                            </table>
                            <br/>
                            <table class="table table-sm o_main_table" style="page-break-inside: avoid;">
                                <tbody>
                                    <t t-set="index" t-value="1"/>
                                    <tr t-foreach="ob.move_lines" t-as="move"
                                        style="font-family: Roboto, Odoo Unicode Support Noto, sans-serif;font-size: 14px; font-weight: 500;">
                                        <td>
                                            <span t-esc="index"/>
                                        </td>
                                        <td>
                                            <span t-field="move.product_id.default_code"/>
                                        </td>
                                        <td>
                                            <span t-field="move.product_id.name"/>
                                        </td>
                                        <td>
                                            <span t-field="move.product_id.description_pickingout"/>
                                        </td>
                                        <td>
                                            <span t-field="move.product_uom_qty"/>
                                        </td>
                                        <td>
                                            <span t-field="move.product_uom"/>
                                        </td>
                                        <td>
                                            <span t-field="move.location_id"/>
                                        </td>
                                        <t t-set="index" t-value="index + 1"/>
                                    </tr>
                                </tbody>
                            </table>

<!--                             <div class="footer o_clean_footer">-->
<!--                                <div class="text-center" style="border-top: 1px solid black;">-->
<!--                                    Batch <span t-field="ob.batch_id"/> Sequence <span t-field="ob.sequence"/> Partner <span t-esc="ob.partner_id.customer_code"/>-->
<!--                                    <div t-if="report_type == 'pdf'" class="text-muted">-->
<!--                                        Page: <span class="page"/> / <span class="topage"/>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                             </div>-->
                            <p style="page-break-after: always;"/>

                         </div>
                        </t>

                </t>
            </t>
        </template>

        <template id="report_batch_picking_all">
            <t t-foreach="docs" t-as="batch_doc">
                <t t-set="batch" t-value="batch_doc"/>
                <t t-set="pickings" t-value="batch_doc.mapped('picking_ids').sorted(key=lambda p: p.sequence, reverse=True)"/>
                <t t-call="batch_delivery.report_picking_batch123"/>
            </t>
        </template>

        <template id="report_batch_picking_active">
            <t t-set="pickings" t-value="docs"/>
            <t t-set="batch" t-value="docs.mapped('batch_id')"/>
            <t t-call="batch_delivery.report_picking_batch123"/>
        </template>


    </data>
</odoo>
